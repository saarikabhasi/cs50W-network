{% extends "network/layout.html" %}

{% block title %}
    Posts
{% endblock %}

{% block body %}
{% load static %}
<!-- <script type ="text/javascript" src="{% static 'post.js' %}"></script> -->

    <h1> All posts</h1>
    <form action="{% url 'network:newpost' %}" method ="POST">
        {% csrf_token %}    
        <button type = "submit" name ="newpost" id ="newpost">Whats on your mind?</button>
    </form> 
    <div id ="showposts"> 
        {% for post in allposts %}
            <hr class="hr_divide_heading">  
            <div id= "post" class = {{post.id}}>
                <h5>{{post.user_id}}</h5>
                <p>{{post.contents}}</p>
                <p>{{post.date_and_time}}</p>
                <p id ='num_likes_{{post.id}}'>{{post.num_of_likes}}</p>

                {% if post.num_of_likes > 0 and post_liked_ids|length  and post.id in post_liked_ids %}
                
                    <!-- <a id ="like" href ="javascript:updatelike(this,'{{user.username}}','{{post.id}}')"><i class="fa fa-heart-o"></i></a>  -->
                    
                    <!-- <a id ="like" href ="#like" onclick ="updatelike(this);" data-section = "{{post.id}}"><i class="fa fa-heart" style = "color:red"></i></a> -->


                        <!-- <a id ="like" href = "" data-section = "{{post.id}}"><i class="fa fa-heart" style = "color:red"></i></a> -->
                        <button id ="like" style = "width: 80px;" value ="{{post.id}}" ><i class="fa fa-heart" style = "color:red"></i></button>

                {% else %}
                        <button id ="like" style = "width: 80px;" value ="{{post.id}}" ><i class="fa fa-heart" style = "color:white"></i></button>
                        <!-- <a id ="like" href = "" data-section = "{{post.id}}"><i class="fa fa-heart" style = "color:white"></i></a> -->
                        <!-- <a id ="like" href ="javascript:updatelike(this);" data-section = "{{post.id}}"><i class="fa fa-heart" style = "color:white"></i></a> -->
                        <!-- <a id ="like" href ="{{post.id}}" onclick ="updatelike(this);" data-section = "{{post.id}}"><i class="fa fa-heart" style = "color:white"></i></a> -->

                {% endif %}
                
            </div>
            {% empty %}

            <h5>No posts</h5>
        {% endfor %}
    </div>
    <script>
        //     function updatelike(_this,username,post_id){
        //         //console.log("update like",username,post_id)
        //     //fetch(`${username}/profile/${section}`)
            
        //         // console.log("this",_this)
        //         // console.log("this",_this.style)
        //         //console.log("text",text)
        //         document.querySelectorAll("#like").forEach(function(e) {
        //             e.addEventListener('click', function() {
        
        //                 fetch(`like/${username}/${post_id}`)
        //     .then(response => response.text())   
        //     .then(text => {
        //                 console.log("click",text)
        //                 if (text === "add"){
        //                     console.log("inside color change")
        //                     this.style.color = "red";
        //         }
            
        //   })
        // });
        
        //         // if (text == "add"){
        //         //     _this.style.backgroundColor = "red";
        //         // }
        //         //fetch("")
        //     })
            
            
        
           
        // }
        
        // function updatelike(_this,post_id){
            
            // IMPO Working funcs
            function updatelike(ele){
                console.log("js :updatelike")
                // console.log(ele.value)

                post_id = parseInt(ele.value)
                console.log(post_id)
                fetch(`like/${post_id}`)
                .then(response => response.text())
                .then(text => {
                    result = JSON.parse(text)
                    console.log("click",result)
                    console.log("click type",result["type"])
                    element = ele.querySelector(".fa-heart")
                    id = `#num_likes_${post_id}`
                    if (result["type"] === "add"){
                        
                        console.log("change to red") 
                        element.style.color = "red";
                        
                    }
                    if (result["type"] === "remove"){
                        console.log("change to white")
                        element.style.color = "white";
                        
                    }
                    console.log(result["num_of_likes"])
                    document.querySelector(id).innerHTML=result["num_of_likes"]

                })
            

           
        }

        
    //IMPO Working funcs
        document.querySelectorAll("#like").forEach( e=> {
            // e.addEventListener('click', function(e) {
    
                e.onclick = function(){
                    
                    //updatelike(this,this.dataset.section)
                    updatelike(this)
                }
                
            });
    
        // });
    
        </script>
   

        
        

  
{% endblock %}